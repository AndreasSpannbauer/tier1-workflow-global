{
  "version": "1.0.0",
  "last_updated": "2025-10-26T00:00:00Z",
  "updates": [
    {
      "id": "agent-model-cleanup-v1",
      "version": "1.0.0",
      "date": "2025-10-26",
      "description": "Remove model definitions from agent frontmatter to prevent token waste and ensure session model usage",
      "priority": "high",
      "source": "Token optimization - prevent unnecessary Opus costs when Sonnet 4.5 suffices",
      "components": [
        {
          "type": "remove_line_pattern",
          "target": ".claude/agents/*.md",
          "pattern": "^model:",
          "idempotent_check": "! grep -q '^model:' {target}",
          "description": "Remove model specifications from all agent files"
        }
      ],
      "validation": {
        "forbidden_patterns": ["^model:"],
        "files_to_check": [
          ".claude/agents/implementation_agent_v1.md",
          ".claude/agents/post_mortem_agent_v1.md",
          ".claude/agents/build_fixer_agent_v1.md",
          ".claude/agents/integration_planning_agent_v1.md"
        ]
      },
      "notes": [
        "Removes model: lines from agent frontmatter to ensure agents use session model",
        "Prevents unnecessary Opus token costs when Sonnet 4.5 suffices",
        "Ensures consistent behavior between main session and agents",
        "Idempotent - safe to run multiple times",
        "No functional impact - agents continue working normally",
        "New deployments via install_tier1_workflow.sh include automatic verification"
      ]
    },
    {
      "id": "agent-failure-reporting-protocol-v1",
      "version": "1.0.0",
      "date": "2025-10-24",
      "description": "Agent Failure Reporting Protocol - prevents simulation code when agents encounter blockers (EPIC-013 fix)",
      "priority": "high",
      "source": "EPIC-013 post-mortem analysis",
      "components": [
        {
          "type": "append_section",
          "target": ".claude/agent_briefings/backend_implementation.md",
          "marker": "## Post-Implementation Checklist",
          "section_file": "implementation/updates/agent-failure-protocol-backend.md",
          "idempotent_check": "grep -q 'BLOCKER DETECTED' {target}",
          "description": "Add blocker reporting protocol to backend briefing"
        },
        {
          "type": "append_section",
          "target": ".claude/agent_briefings/project_architecture.md",
          "marker": "## Summary",
          "section_file": "implementation/updates/agent-failure-protocol-architecture.md",
          "idempotent_check": "grep -q 'BLOCKER DETECTED' {target}",
          "description": "Add blocker reporting protocol to architecture briefing"
        },
        {
          "type": "copy_if_missing",
          "target": "tools/detect_simulation_code.py",
          "source": "template/tools/detect_simulation_code.py",
          "idempotent_check": "test -f {target}",
          "description": "Add simulation detection script"
        }
      ],
      "validation": {
        "required_keywords": ["BLOCKER DETECTED", "No Improvisation When Blocked", "_simulate_", "_mock_", "_fake_"],
        "files_to_check": [
          ".claude/agent_briefings/backend_implementation.md",
          ".claude/agent_briefings/project_architecture.md",
          "tools/detect_simulation_code.py"
        ]
      }
    },
    {
      "id": "transcript-path-hook-v1",
      "version": "1.0.0",
      "date": "2025-10-24",
      "description": "Add UserPromptSubmit hook to capture transcript_path for post-mortem conversation logs",
      "priority": "critical",
      "source": "V6 workflow observability gap - missing conversation transcripts",
      "components": [
        {
          "type": "copy_if_missing",
          "target": ".claude/hooks/capture_transcript_path.py",
          "source": "template/.claude/hooks/capture_transcript_path.py",
          "idempotent_check": "test -f {target}",
          "description": "Add transcript path capture hook"
        },
        {
          "type": "copy_if_missing",
          "target": ".claude/hooks/README.md",
          "source": "template/.claude/hooks/README.md",
          "idempotent_check": "test -f {target}",
          "description": "Add hooks documentation"
        },
        {
          "type": "patch_execute_workflow",
          "target": ".claude/commands/execute-workflow.md",
          "description": "Update execute-workflow to read transcript_path from file",
          "operations": [
            {
              "search": "# Export transcript using standalone utility\npython3 tools/export_conversation_transcript.py \\\n  \"$transcript_path\" \\\n  \".workflow/outputs/${ARGUMENTS}/conversation-transcript.md\" \\\n  \"${ARGUMENTS}\"",
              "replace": "# Read transcript_path from file written by UserPromptSubmit hook\ntranscript_path=\"\"\nif [ -f \".workflow/transcript_path.txt\" ]; then\n  transcript_path=$(cat .workflow/transcript_path.txt)\nfi\n\nif [ -n \"$transcript_path\" ] && [ -f \"$transcript_path\" ]; then\n  # Export transcript using standalone utility\n  python3 tools/export_conversation_transcript.py \\\n    \"$transcript_path\" \\\n    \".workflow/outputs/${ARGUMENTS}/conversation-transcript.md\" \\\n    \"${ARGUMENTS}\"\nelse\n  echo \"‚ö†Ô∏è Transcript path not available (hook may not be configured)\"\n  echo \"   To enable: Add UserPromptSubmit hook in .claude/settings.json\"\n  echo \"   Continuing with post-mortem using placeholder...\"\nfi",
              "idempotent_check": "grep -q 'transcript_path.txt' {target}"
            }
          ]
        },
        {
          "type": "merge_json",
          "target": ".claude/settings.json",
          "merge_data": {
            "hooks": {
              "UserPromptSubmit": [
                {
                  "hooks": [
                    {
                      "type": "command",
                      "command": "python3 .claude/hooks/capture_transcript_path.py"
                    }
                  ]
                }
              ]
            }
          },
          "idempotent_check": "grep -q 'capture_transcript_path' {target} || ! test -f {target}",
          "description": "Add UserPromptSubmit hook to settings.json"
        }
      ],
      "validation": {
        "required_files": [
          ".claude/hooks/capture_transcript_path.py",
          ".claude/hooks/README.md"
        ],
        "required_keywords": [
          "transcript_path.txt",
          "UserPromptSubmit",
          "capture_transcript_path.py"
        ],
        "files_to_check": [
          ".claude/settings.json",
          ".claude/commands/execute-workflow.md"
        ]
      },
      "notes": [
        "This update fixes the critical observability gap where conversation transcripts were not being exported to post-mortem analysis",
        "Hook must be executable: chmod +x .claude/hooks/capture_transcript_path.py",
        "After deployment, verify .workflow/transcript_path.txt is created when slash commands run",
        "This enables full conversation history in post-mortem reports for better workflow analysis"
      ]
    },
    {
      "id": "tier1-constitution-v1",
      "version": "1.0.0",
      "date": "2025-10-25",
      "description": "Add lightweight 6-article constitution with git automation",
      "priority": "high",
      "components": [
        {
          "type": "copy_if_missing",
          "target": ".claude/constitution.md",
          "source": "template/.claude/constitution.md",
          "idempotent_check": "test -f {target}",
          "description": "Add Tier1 constitution document"
        },
        {
          "type": "copy_if_missing",
          "target": "tools/validate_constitutional_compliance.py",
          "source": "template/tools/validate_constitutional_compliance.py",
          "idempotent_check": "test -f {target}",
          "description": "Add constitutional compliance validator"
        },
        {
          "type": "copy_if_missing",
          "target": "tools/git_workflow_commit.py",
          "source": "template/tools/git_workflow_commit.py",
          "idempotent_check": "test -f {target}",
          "description": "Add git workflow automation script"
        },
        {
          "type": "copy_if_missing",
          "target": "tools/generate_commit_message.py",
          "source": "template/tools/generate_commit_message.py",
          "idempotent_check": "test -f {target}",
          "description": "Add commit message generator"
        },
        {
          "type": "copy_if_missing",
          "target": "tools/pre-commit-hook.sh",
          "source": "template/tools/pre-commit-hook.sh",
          "idempotent_check": "test -f {target}",
          "description": "Add pre-commit hook template"
        },
        {
          "type": "append_section",
          "target": "CLAUDE.md",
          "marker": "## üéØ Primary Use Cases",
          "section_file": "implementation/updates/tier1-constitution-v1/claude-md-section.md",
          "idempotent_check": "grep -q 'Constitutional Compliance' {target}",
          "description": "Add constitution documentation to CLAUDE.md"
        }
      ],
      "validation": {
        "required_files": [
          ".claude/constitution.md",
          "tools/validate_constitutional_compliance.py",
          "tools/git_workflow_commit.py",
          "tools/generate_commit_message.py",
          "tools/pre-commit-hook.sh"
        ],
        "required_keywords": [
          "Article I",
          "Article II",
          "Article III",
          "Constitutional Compliance"
        ],
        "files_to_check": [
          ".claude/constitution.md",
          "CLAUDE.md"
        ]
      },
      "notes": [
        "This update adds the Tier1 6-article constitution to projects",
        "Pre-commit hook blocks on Article III violations (simulation code)",
        "Other articles generate warnings only (not blocking)",
        "Git workflow automation scripts enable WIP commits before/after workflows",
        "After deployment, install hook: cp tools/pre-commit-hook.sh .git/hooks/pre-commit && chmod +x .git/hooks/pre-commit"
      ]
    },
    {
      "id": "mandatory-library-research-v1",
      "version": "1.0.0",
      "date": "2025-10-25",
      "description": "Enforce Pattern Library ‚Üí Context7 research workflow for all external dependencies in spec creation",
      "priority": "critical",
      "source": "Pattern library underutilization - Context7 MCP not being queried during spec phase",
      "components": [
        {
          "type": "insert_before",
          "target": ".claude/commands/spec-epic.md",
          "marker": "## Generate Epic ID",
          "section_file": "implementation/updates/mandatory-library-research-v1/mandatory-library-research-spec-epic-section.md",
          "idempotent_check": "grep -q 'Research External Libraries (MANDATORY)' {target}",
          "description": "Add mandatory library research phase to spec-epic workflow"
        },
        {
          "type": "replace_section",
          "target": ".claude/output-styles/spec-architect-*.md",
          "start_marker": "## Mandatory Pre-Specification Analysis",
          "end_marker": "### 3. Graph-Server Intelligence",
          "replacement_file": "implementation/updates/mandatory-library-research-v1/mandatory-library-research-spec-architect-section.md",
          "idempotent_check": "grep -q 'mcp__pattern-library__search_patterns' {target}",
          "description": "Replace pre-spec analysis section with enforced research workflow"
        }
      ],
      "validation": {
        "required_keywords": [
          "Research External Libraries (MANDATORY)",
          "mcp__pattern-library__search_patterns",
          "mcp__context7__resolve-library-id",
          "Pattern Library First",
          "Context7 Fallback",
          "research/README.md"
        ],
        "files_to_check": [
          ".claude/commands/spec-epic.md",
          ".claude/output-styles/spec-architect-*.md"
        ]
      },
      "notes": [
        "This update enforces the Pattern Library ‚Üí Context7 research workflow during spec creation",
        "Pattern library is always queried FIRST to save tokens and ensure consistency",
        "Context7 is used as FALLBACK when pattern library has no relevant patterns",
        "All Context7 calls are auto-queued for extraction to grow the pattern library",
        "Research phase is MANDATORY - architecture design cannot proceed without it",
        "This ensures pattern library is actively maintained and continuously improved",
        "Expected outcome: Pattern library becomes comprehensive, reducing Context7 dependency over time"
      ]
    },
    {
      "id": "github-ai-review-integration-v1",
      "version": "1.0.0",
      "date": "2025-10-29",
      "description": "Add GitHub integration with @claude and @codex AI review automation",
      "priority": "medium",
      "source": "email_management_system implementation - automatic PR creation with AI review tags",
      "components": [
        {
          "type": "copy_if_missing",
          "target": ".github/workflows/claude.yml",
          "source": "template/.github/workflows/claude.yml",
          "idempotent_check": "test -f {target}",
          "description": "Add @claude mention trigger workflow (GitHub Actions)"
        },
        {
          "type": "copy_if_missing",
          "target": ".github/workflows/QUICK_REFERENCE.md",
          "source": "template/.github/workflows/QUICK_REFERENCE.md",
          "idempotent_check": "test -f {target}",
          "description": "Add quick reference guide for GitHub integration"
        },
        {
          "type": "copy_if_missing",
          "target": ".github/workflows/MENTION_TRIGGERS_SETUP.md",
          "source": "template/.github/workflows/MENTION_TRIGGERS_SETUP.md",
          "idempotent_check": "test -f {target}",
          "description": "Add complete setup instructions"
        },
        {
          "type": "copy_if_missing",
          "target": ".github/workflows/scripts/verify-mention-triggers.sh",
          "source": "template/.github/workflows/scripts/verify-mention-triggers.sh",
          "idempotent_check": "test -f {target}",
          "executable": true,
          "description": "Add verification script for mention triggers setup"
        },
        {
          "type": "copy_if_missing",
          "target": "tools/github_integration/pr_with_ai_review.py",
          "source": "template/tools/github_integration/pr_with_ai_review.py",
          "idempotent_check": "test -f {target}",
          "executable": true,
          "description": "Add PR creation helper with AI review tags"
        },
        {
          "type": "insert_before",
          "target": ".claude/commands/execute-workflow.md",
          "marker": "### Step 5.4: Move Epic to Completed",
          "section_file": "implementation/updates/github-ai-review-integration-v1/execute-workflow-phase-5-3.md",
          "idempotent_check": "grep -q 'Step 5.3: Create Feature Branch and Pull Request with AI Review' {target}",
          "description": "Add Phase 5.3 for automatic PR creation with AI review"
        }
      ],
      "validation": {
        "required_files": [
          ".github/workflows/claude.yml",
          ".github/workflows/QUICK_REFERENCE.md",
          ".github/workflows/MENTION_TRIGGERS_SETUP.md",
          ".github/workflows/scripts/verify-mention-triggers.sh",
          "tools/github_integration/pr_with_ai_review.py"
        ],
        "required_keywords": [
          "@claude",
          "@codex",
          "AI Review Requested",
          "pr_with_ai_review",
          "Step 5.3"
        ],
        "files_to_check": [
          ".github/workflows/claude.yml",
          ".claude/commands/execute-workflow.md"
        ]
      },
      "notes": [
        "This update adds automatic GitHub integration for AI code review",
        "@claude responds to mentions in issues/PRs via GitHub Actions (30-60s response time)",
        "@codex is optional and requires Codex Cloud configuration",
        "Phase 5.3 automatically creates feature branch and PR with AI review tags",
        "Requires CLAUDE_CODE_OAUTH_TOKEN secret setup per repository (one-time)",
        "Generate token: claude /token, then add to GitHub Settings ‚Üí Secrets ‚Üí Actions",
        "Verification: .github/workflows/scripts/verify-mention-triggers.sh",
        "Non-blocking: PR creation failures don't stop workflow execution",
        "Already deployed to: whisper_hotkeys, ppt_pipeline, orchestrator"
      ]
    }
  ]
}
